# Техническая сводка: Игра "Змейка"

## Общее описание
Классическая игра "Змейка" с поддержкой двух режимов: мультиплеер (два игрока) и игра против ИИ-бота. Реализована на Python с использованием библиотеки Tkinter.

## Технологический стек
- **Язык**: Python 3
- **GUI**: Tkinter (tkinter, messagebox, Canvas)
- **Алгоритмы**: heapq (для A*), random (генерация еды)

## Архитектура

### Основные компоненты

#### 1. Класс `Snake`
- **Назначение**: Представляет змейку в игре
- **Атрибуты**:
  - `body`: список координат сегментов тела [(x, y), ...]
  - `direction`: текущее направление движения (dx, dy)
  - `next_direction`: следующее направление (для плавной смены)
  - `color`: цвет змейки (hex)
  - `score`: счет игрока
- **Методы**:
  - `move()`: добавляет новую голову, обновляет направление
  - `grow()`: увеличивает счет (рост происходит через отсутствие `shrink()`)
  - `shrink()`: удаляет хвост (если длина > 1)

#### 2. Алгоритм поиска пути (A*)
- **Функция**: `find_path_to_food(snake, food, obstacles, cols, rows)`
- **Алгоритм**: A* с эвристикой Манхэттенского расстояния
- **Особенности**:
  - Учитывает препятствия (тела всех змеек)
  - Возвращает следующую позицию от головы
  - Сложность: O(b^d), где b - branching factor, d - глубина

#### 3. Логика бота
- **Функция**: `get_bot_direction(snake, food, all_snakes, cols, rows)`
- **Стратегия**:
  1. Приоритет: A* для оптимального пути
  2. Fallback: жадный алгоритм (минимизация Манхэттенского расстояния)
  3. Безопасность: избегает разворота на 180°, проверяет границы и препятствия

#### 4. Игровой цикл
- **Функция**: `game_loop()`
- **Логика**:
  1. Управление ботом (если режим "computer")
  2. Движение всех змеек
  3. Проверка столкновений (стены, себя, других змеек)
  4. Проверка поедания еды
  5. Автоматический перезапуск при столкновении
  6. Перерисовка и рекурсивный вызов через `after()`

## Параметры игры

### Игровое поле
- **Размер**: 400×300 пикселей
- **Сетка**: 20×15 клеток (cell_size = 20px)
- **Координаты**: дискретные (x, y) в клетках

### Скорость игры
- **Медленная**: 200 мс на ход
- **Средняя**: 150 мс на ход
- **Быстрая**: 100 мс на ход

### Режимы игры
1. **"С другом"** (`mode="friend"`):
   - Две змейки: игрок 1 (WASD), игрок 2 (стрелки)
   - Обе змейки управляются вручную

2. **"Против компьютера"** (`mode="computer"`):
   - Две змейки: игрок 1 (WASD), бот (автоматически)
   - Счет второго игрока скрыт

## Механика игры

### Движение
- Змейка движется по сетке (пошагово)
- Направление меняется только на 90° (нельзя развернуться назад)
- Голова рисуется прямоугольником, тело - овалами

### Еда
- Генерируется случайно в свободной клетке
- При поедании: змейка растет (не удаляется хвост), счет +1
- Новая еда появляется сразу после поедания

### Столкновения
- Со стенами (выход за границы поля)
- С собой (голова попадает в тело)
- С другой змейкой (голова попадает в тело другой)
- **Результат**: автоматический перезапуск (сброс позиций, счетов, новая еда)

## UI/UX

### Цветовая схема
- Фон меню/игры: `#FFE5EA` (розовый)
- Акценты: `#E381B1` (розово-фиолетовый)
- Поле: `#FFF0F5` (светло-розовый)
- Змейка 1: `#FF6B9D` (розовая)
- Змейка 2: `#4ECDC4` (бирюзовая)
- Еда: `#FFD700` (золотая)

### Шрифты
- Заголовки: "Press Start 2P" (pixel font)
- Текст: "Candara"

### Окна
- Главное меню: 400×400px
- Игровое окно: 600×500px
- Настройки: 300×200px (модальное)

## Особенности реализации

### Оптимизации
- Использование `tags` в Canvas для группового удаления объектов
- Set для быстрой проверки препятствий в A*
- Heapq для эффективной работы с приоритетной очередью

### Обработка событий
- Клавиатура: `bind('<KeyPress>')` с фокусом на окне
- Игровой цикл: рекурсивные вызовы через `after()` (неблокирующий)

### Управление состоянием
- Глобальный словарь `settings` для настроек
- Локальные переменные в замыканиях для игрового состояния
- Автоматический сброс при столкновении

## Структура файла
```
snake.py (478 строк)
├── Импорты и настройки
├── Класс Snake
├── Алгоритмы поиска пути (A*, жадный)
├── Функции управления ботом
├── open_game_window() - основная игровая логика
├── open_settings() - окно настроек
└── Главное меню и root.mainloop()
```

## Зависимости
- Стандартная библиотека Python (tkinter, random, heapq)
- Внешние зависимости отсутствуют

## Производительность
- Игровой цикл: O(n) где n - количество змеек
- A* алгоритм: O(b^d) в худшем случае
- Отрисовка: O(m) где m - общая длина всех змеек
- Подходит для реального времени при текущих параметрах

